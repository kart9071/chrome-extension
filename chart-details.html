<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chart Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
      overflow: auto;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    #loading {
      color: #007bff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2 id="heading">Chart Details</h2>
  <div id="content"><span id="loading">Loading...</span></div>
  <button onclick="window.close()">Close</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const member_id = urlParams.get("member_id");
    const member_name = urlParams.get("member_name");

    document.getElementById("heading").textContent = `Chart Details - ${member_name}`;

    // Send message to background to fetch data (avoids CORS)
    chrome.runtime.sendMessage(
      {
        action: "fetchChartDetails",
        payload: { member_id, member_name }
      },
      (response) => {
        const contentDiv = document.getElementById("content");

        if (chrome.runtime.lastError) {
          contentDiv.innerHTML = `<p style="color:red;">Error: ${chrome.runtime.lastError.message}</p>`;
          return;
        }

        if (!response) {
          contentDiv.innerHTML = `<p style="color:red;">No response from background script.</p>`;
          return;
        }

        if (response.error) {
          contentDiv.innerHTML = `<p style="color:red;">‚ùå ${response.error}</p>`;
        } else {
          contentDiv.innerHTML = `<pre>${JSON.stringify(response.data, null, 2)}</pre>`;
        }
      }
    );
  </script>
</body>
</html>
